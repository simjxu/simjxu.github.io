{"expireTime":9007200869921788000,"key":"transformer-remark-markdown-ast-5a4e3145f05d939faac1c9d7d70d1dc4--","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"I had quite a few struggles getting BLE to work, until I finally decided to test out an Arduino (shudder) example of the BLE implemention on the B-L475E. Hopefully, insights gleaed from this will point me in the right direction for the manual implementation of the BLE library. The working example is located here: ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":316,"offset":316},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/stm32duino/STM32Examples/blob/master/examples/Boards/STM32L475VG-DISCOVERY-IOT/BTLE_sensors_TimeOfFlight_demo/BTLE_sensors_TimeOfFlight_demo.ino","children":[{"type":"text","value":"https://github.com/stm32duino/STM32Examples/blob/master/examples/Boards/STM32L475VG-DISCOVERY-IOT/BTLE","position":{"start":{"line":2,"column":316,"offset":316},"end":{"line":2,"column":418,"offset":418},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"sensors","position":{"start":{"line":2,"column":419,"offset":419},"end":{"line":2,"column":426,"offset":426},"indent":[]}}],"position":{"start":{"line":2,"column":418,"offset":418},"end":{"line":2,"column":427,"offset":427},"indent":[]}},{"type":"text","value":"TimeOfFlight","position":{"start":{"line":2,"column":427,"offset":427},"end":{"line":2,"column":439,"offset":439},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"demo/BTLE","position":{"start":{"line":2,"column":440,"offset":440},"end":{"line":2,"column":449,"offset":449},"indent":[]}}],"position":{"start":{"line":2,"column":439,"offset":439},"end":{"line":2,"column":450,"offset":450},"indent":[]}},{"type":"text","value":"sensors","position":{"start":{"line":2,"column":450,"offset":450},"end":{"line":2,"column":457,"offset":457},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"TimeOfFlight","position":{"start":{"line":2,"column":458,"offset":458},"end":{"line":2,"column":470,"offset":470},"indent":[]}}],"position":{"start":{"line":2,"column":457,"offset":457},"end":{"line":2,"column":471,"offset":471},"indent":[]}},{"type":"text","value":"demo.ino","position":{"start":{"line":2,"column":471,"offset":471},"end":{"line":2,"column":479,"offset":479},"indent":[]}}],"position":{"start":{"line":2,"column":316,"offset":316},"end":{"line":2,"column":479,"offset":479},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":479,"offset":479},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are a few dependencies to get this working. In ","position":{"start":{"line":4,"column":1,"offset":481},"end":{"line":4,"column":54,"offset":534},"indent":[]}},{"type":"inlineCode","value":"main.cpp","position":{"start":{"line":4,"column":54,"offset":534},"end":{"line":4,"column":64,"offset":544},"indent":[]}},{"type":"text","value":", there is a set of comments on the top pointing you to the driver libraries, and of course, you need the SPBTLE-RF library, which depends upon Arduino.h.","position":{"start":{"line":4,"column":64,"offset":544},"end":{"line":4,"column":218,"offset":698},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":481},"end":{"line":4,"column":218,"offset":698},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://raw.githubusercontent.com/simjxu/simjxu.github.io/gh-pages/img/SPBTLE-RF_lib.jpg","alt":"SPBTLE-lib","position":{"start":{"line":6,"column":1,"offset":700},"end":{"line":6,"column":104,"offset":803},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":700},"end":{"line":6,"column":104,"offset":803},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Inside this example, the top level function that publishes the data to BLE is the function called  ","position":{"start":{"line":8,"column":1,"offset":805},"end":{"line":8,"column":100,"offset":904},"indent":[]}},{"type":"inlineCode","value":"update_environment_data","position":{"start":{"line":8,"column":100,"offset":904},"end":{"line":8,"column":125,"offset":929},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":805},"end":{"line":8,"column":125,"offset":929},"indent":[]}},{"type":"code","lang":"cpp","value":"void update_environment_data(){\n  float humidity, temperature;\n  float pressure, temperature_lps22hb;\n\n  HumTemp->GetHumidity(&humidity);\n  HumTemp->GetTemperature(&temperature);\n\n  PressTemp->GetPressure(&pressure);\n  PressTemp->GetTemperature(&temperature_lps22hb);\n\n  //Update environnemental data\n  SensorService.Temp_Update(temperature*10);\n  SensorService.Press_Update(pressure*100);\n  SensorService.Humidity_Update(humidity*10);\n}","position":{"start":{"line":10,"column":1,"offset":931},"end":{"line":26,"column":4,"offset":1379},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Once I load the firmware onto the device, I am able to use the LightBlue mobile app from PunchThrough to observe these three characteristics. You can see below that the humidity is 59.3% (593/10) and the temperature is 23.4 deg C (234/10).","position":{"start":{"line":28,"column":1,"offset":1381},"end":{"line":28,"column":240,"offset":1620},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1381},"end":{"line":28,"column":240,"offset":1620},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://raw.githubusercontent.com/simjxu/simjxu.github.io/gh-pages/img/lightblue_att.jpg","alt":"temp-humid-ble","position":{"start":{"line":30,"column":1,"offset":1622},"end":{"line":30,"column":108,"offset":1729},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":1622},"end":{"line":30,"column":108,"offset":1729},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":32,"column":1,"offset":1731}}}}