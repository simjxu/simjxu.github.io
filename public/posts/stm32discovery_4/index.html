<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.3d44ac656aca5ca4ccda.css" id="gatsby-global-css">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:link{color:#add8e6}a:visited{color:grey}a:hover{outline-width:0;color:orange}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:rgba(0,0,0,.8);font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em;content:" "}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}</style><meta name="generator" content="Gatsby 2.31.1"/><script>window.__EMOTION_CRITICAL_CSS_IDS__ = [];</script><style></style><title data-react-helmet="true">The Mush</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link as="script" rel="preload" href="/webpack-runtime-ec7209389deb8a46b250.js"/><link as="script" rel="preload" href="/framework-513632b9031254dfb5ad.js"/><link as="script" rel="preload" href="/app-7ca0e52e0610a05c0383.js"/><link as="script" rel="preload" href="/styles-e9d24b1846c7d6eb9685.js"/><link as="script" rel="preload" href="/907a01899e9c5216f64e0ef7b1b8e8d2d368487b-6ba01923175e815d4944.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-6be0601bb8e1e3e7487a.js"/><link as="fetch" rel="preload" href="/page-data/posts/stm32discovery_4/page-data.json" crossOrigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossOrigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossOrigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="background:#2f3143;margin-bottom:1.45rem"><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><header style="margin-bottom:0rem"><ul style="list-style:none;float:right"><li style="display:inline-block;margin-right:1rem"><a href="/about/">About</a></li><li style="display:inline-block;margin-right:1rem"><a href="/projects/">Projects</a></li><a href="http://app.simonxu.com">WebApp</a></ul></header><h1 style="margin:0"><a style="color:white;text-decoration:none" href="/">The Mush</a></h1></div></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div><h1>B-L475E-IOT01A - Triggering external interrupt using Button</h1><div><p>What I thought would be a relatively easy thing to accomplish ended up being slightly trickier than I expected. I spent this weekend trying to trigger the print out on the virtual COM port via an eternal interrupt by the blue user button. On this board it is connected to pin PC13. The "C" represents the GPIO group, and frequently, functions will require indication of the GPIO_PIN as well as the group, in this case "GPIOC".</p>
<p>In this latest commit: 82a0425cd5a82bbebd32750e4ce07c01f5c65044, I copied some pin initializations, NVIC (which determines interrupt priority). and entered in an external interrupt callback function. This callback function triggers whenever any pin EXTI pin triggers it. Eventually, I will need to update this below function to check specifically for the user button. </p>
<pre><code class="language-cpp">void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
  /* Prevent unused argument(s) compilation warning */
  UNUSED(GPIO_Pin);
  if(sensorprint_flag==0){
    // try using a queue
    sensorprint_flag = 1;
    HAL_GPIO_TogglePin(GPIOB,LED2_Pin);
  }
}
</code></pre>
<p>This interrupt callback is implemented in such a way as to not stay too long in the interrupt callback. A flag is toggled so that the main loop can then take care of whatever actions are necessary, in this case printing out the sensor readings. It is important not to execute functions like usb print in an external interrupt, because this can lead to stack overflow. A final step to close this branch out is to add a queue so that if multiple interrupts are called, the neccesary actions will still complete.</p>
<pre><code>while (1)
{
  // Put all this into a queue
  if(sensorprint_flag){
    // Print out all the sensor readings
    sensors.printTemp(2);
    sensors.printHumid(2);
    sensors.printPressure(2);
    sensors.printAccel();
    sensors.printGyro();
    sensors.printMagneto();
    usb_print(carriage_return,sizeof(carriage_return)-1);
    sensorprint_flag=0;
  }
}
</code></pre></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/stm32discovery_4/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-d47b21a5737d9524fa70.js"],"app":["/app-7ca0e52e0610a05c0383.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-9cfc042f471adb8b7421.js"],"component---src-pages-404-js":["/component---src-pages-404-js-99defb49b38a8f14097f.js"],"component---src-pages-about-js":["/component---src-pages-about-js-a642bbb7f4517cf34505.js"],"component---src-pages-index-js":["/component---src-pages-index-js-877b418916fa80f6af91.js"],"component---src-pages-my-files-js":["/component---src-pages-my-files-js-47e8199b821dcfb925af.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-8eb80cdd29113e8dd8d6.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-6be0601bb8e1e3e7487a.js"]};/*]]>*/</script><script src="/polyfill-d47b21a5737d9524fa70.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-6be0601bb8e1e3e7487a.js" async=""></script><script src="/907a01899e9c5216f64e0ef7b1b8e8d2d368487b-6ba01923175e815d4944.js" async=""></script><script src="/styles-e9d24b1846c7d6eb9685.js" async=""></script><script src="/app-7ca0e52e0610a05c0383.js" async=""></script><script src="/framework-513632b9031254dfb5ad.js" async=""></script><script src="/webpack-runtime-ec7209389deb8a46b250.js" async=""></script></body></html>