{"expireTime":9007200877953585000,"key":"transformer-remark-markdown-ast-ee9b2e016273087a5ca965067cd155ef--","val":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"Since I'm starting off right now coding on bare metal (I'm not running an RTOS), I've got only the main() thread running and no other task manager to speak of. This means I have limited options when addressing the flow of tasks in my code. For example, what I've observed is that if I make two calls to ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":304,"offset":304},"indent":[]}},{"type":"inlineCode","value":"CDC_Transmit_FS","position":{"start":{"line":2,"column":304,"offset":304},"end":{"line":2,"column":321,"offset":321},"indent":[]}},{"type":"text","value":" consecutively, the second one doesn't run:","position":{"start":{"line":2,"column":321,"offset":321},"end":{"line":2,"column":364,"offset":364},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":364,"offset":364},"indent":[]}},{"type":"code","lang":"cpp","meta":null,"value":"void ExampleClass::printChar()\n{\n    int len = strlen(this->charValue);          // charValue = \"charstr\"\n    uint8_t charout[] = \"printChar Output: \";\n    CDC_Transmit_FS(charout, 18);\n    CDC_Transmit_FS((uint8_t*)this->charValue,len);        \n}","position":{"start":{"line":4,"column":1,"offset":366},"end":{"line":12,"column":4,"offset":624},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Results with a printout of the following","position":{"start":{"line":14,"column":1,"offset":626},"end":{"line":14,"column":41,"offset":666},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":626},"end":{"line":14,"column":41,"offset":666},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"--- Miniterm on /dev/cu.usbmodem205A319838471  9600,8,N,1 ---\n--- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---\nHello World!\nprintChar Output: Hello World!\nprintChar Output: Hello World!\nprintChar Output: Hello World!\nprintChar Output: Hello World!","position":{"start":{"line":15,"column":1,"offset":667},"end":{"line":23,"column":4,"offset":943},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"I expected to see \"charstr\\n\" after printChar output (so charstr with a carriage return). Why does this happen? Because the call to ","position":{"start":{"line":25,"column":1,"offset":945},"end":{"line":25,"column":133,"offset":1077},"indent":[]}},{"type":"inlineCode","value":"CDC_Transmit_FS","position":{"start":{"line":25,"column":133,"offset":1077},"end":{"line":25,"column":150,"offset":1094},"indent":[]}},{"type":"text","value":" gets called while the USB peripheral is still busy. Therefore, the way to fix this is to include CDC","position":{"start":{"line":25,"column":150,"offset":1094},"end":{"line":25,"column":251,"offset":1195},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"Transmit","position":{"start":{"line":25,"column":252,"offset":1196},"end":{"line":25,"column":260,"offset":1204},"indent":[]}}],"position":{"start":{"line":25,"column":251,"offset":1195},"end":{"line":25,"column":261,"offset":1205},"indent":[]}},{"type":"text","value":"FS with another function that will do a busy wait.","position":{"start":{"line":25,"column":261,"offset":1205},"end":{"line":25,"column":311,"offset":1255},"indent":[]}}],"position":{"start":{"line":25,"column":1,"offset":945},"end":{"line":25,"column":311,"offset":1255},"indent":[]}},{"type":"code","lang":"cpp","meta":null,"value":"void usb_print(uint8_t* Buf, uint16_t Len){\n    while (CDC_Transmit_FS(Buf,Len)) {}     // Busy wait to ensure that the transmit completes\n}\n\nvoid ExampleClass::printChar()\n{\n    int len = strlen(this->charValue);\n    uint8_t charout[] = \"printChar Output: \";     \n\n    usb_print(charout,18);\n    usb_print((uint8_t*)this->charValue,len);\n}","position":{"start":{"line":27,"column":1,"offset":1257},"end":{"line":40,"column":4,"offset":1608},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"And here is the result!","position":{"start":{"line":42,"column":1,"offset":1610},"end":{"line":42,"column":24,"offset":1633},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":1610},"end":{"line":42,"column":24,"offset":1633},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"--- Miniterm on /dev/cu.usbmodem205A319838471  9600,8,N,1 ---\n--- Quit: Ctrl+C | Menu: Ctrl+T | Help: Ctrl+T followed by Ctrl+H ---\nHello World!\nprintChar Output: charstr\nHello World!\nprintChar Output: charstr\nHello World!\nprintChar Output: charstr","position":{"start":{"line":43,"column":1,"offset":1634},"end":{"line":52,"column":4,"offset":1890},"indent":[1,1,1,1,1,1,1,1,1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":52,"column":4,"offset":1890}}}}